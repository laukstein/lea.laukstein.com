"use strict";ui.payment=ui.legacy(function(){var t,n,a,i,s=ui.d.getElementById("status"),c={toContact:" לשאלות אנא <a href=/contact>צרי קשר</a>"};return Object.assign(c,{notFound:"הזמנה זו לא נמצאה."+c.toContact,networkError:"ישנה תקלה בשרת."+c.toContact,networkOutage:"ישנה תקלה זמנית בשרת. אנא נסי שוב מאוחר יותר",serverError:"ישנה תקלה בשרת, אנא <a href=/contacts>צרי קשר</a> להמשך הטיפול בהזמנה",invalidRequest:"קישור לא תקין."+c.toContact}),(n=function(){var e,t,o=ui.d.pelepayform;i=ui.hash(),e=ui.serialize({orderid:i.orderid}),ui.pageProgress=ui.pageProgress||s.innerHTML,s.innerHTML=ui.pageProgress,history.replaceState&&(location.search&&(ui.log(location.href),history.replaceState("",ui.d.title,location.pathname+location.hash)),e&&e!==location.hash.substring(1)&&(location.search||ui.log(location.href),history.replaceState("",ui.d.title,location.pathname+"#"+e))),i.email&&(i.email=i.email.toLowerCase(),ui.setUser(ui.filterObj({email:i.email,tel:i.phone,firstname:i.firstname,lastname:i.lastname}))),i.orderid&&o?(t=["orderid","email","phone","firstname","lastname","utm_campaign","utm_source"],i=ui.filterObj(i,function(e){var r=t.includes(e)&&!/\*\|.*?\|\*/.test(i[e]);return r&&e.startsWith("utm_")&&ui.log(e,i[e]),r}),n.onlyFetch(function(e,r){i.token=r,fetch(ui.endpoint+"/payment",{method:"POST",redirect:"error",body:JSON.stringify(i)}).then(function(e){return n.verifyStatus(e,r,"notFound")}).then(function(e){return e.error?Promise.reject(e):e}).then(function(t){return t.custom?(ui.payment=t,Object.keys(t).forEach(function(e){var r=ui.d.createElement("input");r.type="hidden",r.name=e,r.value=t[e],o.appendChild(r)}),ui.log("Payment "+t.orderid+(t.email?" "+t.email:"")),console.log(t),void o.submit()):Promise.reject(new Error("serverError"))}).catch(function(e){r===a&&n.onError(c.notFound,e)})})):n.onError(c.invalidRequest)}).onlyFetch=function(e){var r;ui.w.AbortController&&(t&&t.abort(),r=(t=new AbortController).signal),"function"==typeof e&&e(r,a=ui.generateID())},n.onError=function(e,r){if("AbortError"!==(r=r||{}).name){switch(console.warn(i),r.message){case"notFound":case"serverError":console.error(r.message),e=c[r.message];break;case"Failed to fetch":console.error(r.message),e=c.networkOutage;break;case"NetworkError when attempting to fetch resource.":console.error(r.message),e=c.networkError}if(window.FS)try{FS.event("ConnectionError",ui.filterObj({payment_id_str:i&&i.orderid,payment_error_str:r.message}))}catch(e){console.error(e)}console.trace&&console.trace(),s.innerHTML="<div class=error>"+e+"</div>",t&&t.abort()}},n.verifyStatus=function(e,r,t){switch(e.status){case 200:return r===a&&e.json();case 400:return Promise.reject(new Error(t));case 503:return Promise.reject(new Error("serverError"));default:return Promise.reject(new Error("Failed to fetch"))}},ui.w.addEventListener("hashchange",n),n()});