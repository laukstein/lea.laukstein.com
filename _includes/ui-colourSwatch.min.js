ui.colourSwatch=ui.legacy(function(){"use strict";var e,t,i,n,r,a,o,l,c,s=function(){for(var e=location.host.split(".");e.length>2;)e.shift();return"https://lab."+e.join(".")+"/webhook"}(),u=ui.d.querySelector(".table.scale"),d=ui.d.getElementById("status");return r=function(t){var i;ui.w.AbortController&&(n&&n.abort(),n=new AbortController,i=n.signal),"function"==typeof t&&(a=e.uniqueID(),t(i,a))},o=function(e,i){i=i||{},"AbortError"!==i.name&&(console.warn(c),u.classList.remove("no-padding"),"Failed to fetch"===i.message&&(e="תקלה זמנית בשרת. תנסי שוב מאוחר יותר"),t=!1,d.innerHTML='<div class="table center">    <div class=cel>        <div class=error>'+e+"</div>    </div></div>",n&&n.abort())},l=function(){var n,l,f;return u.classList.remove("no-padding"),a=void 0,ui.pageProgress=ui.pageProgress||d.innerHTML,d.innerHTML=ui.pageProgress,f=function(){return t=!1,location.hash&&(c=ui.hash(),i=c.transaction)?(r(function(t,n){fetch(s+"/payment/order",{method:"POST",redirect:"error",signal:t,body:JSON.stringify({transaction:i})}).then(function(e){return 200===e.status?n===a&&e.json():Promise.reject(new Error("Failed to fetch"))}).then(function(e){return e.error?Promise.reject(e):e}).then(function(t){e(t,n)})["catch"](function(e){n===a&&o("ההזמנה זו לא נמצא. לשאלות <a href=/contact>תצרי קשר</a>",e)})}),!0):(o("גישה רק ללקוחות <a href=/colour>"+ui.d.title+"</a>"),!1)},location.search?(c=ui.hash({hash:location.search}),n=function(e,t){return Object.keys(e).filter(function(i){return t(i,e)}).reduce(function(t,i){return t[i]=e[i],t},{})},l=["orderid","transaction","email","phone","firstname","lastname","utm_source","utm_campaign"],c.custom&&(Object.assign(c,ui.hash({hash:atob(c.custom)})),delete c.custom),c.index&&(c.transaction=c.index,delete c.index),c.email&&(c.email=c.email.toLowerCase(),ui.setUser(n({email:c.email,tel:c.phone,firstName:c.firstname,lastName:c.lastname},function(e,t){return!!t[e]}))),c.token===sessionStorage.paymentToken&&c.orderid&&c.email&&c.transaction?(c=n(c,function(e){return l.includes(e)}),r(function(t,n){fetch(s+"/payment/register",{method:"POST",redirect:"error",signal:t,body:JSON.stringify(c)}).then(function(e){return 200===e.status?n===a&&e.json():Promise.reject(new Error("Failed to fetch"))}).then(function(t){i=t.transaction,history.replaceState&&history.replaceState("",ui.d.title,location.pathname+"#transaction="+i),e(t,n)})["catch"](function(e){n===a&&o("גישה לדף הזה מורשית רק דרך דף התשלום",e)})})):f()):f(),c},e=function(t,i){var n,r=e,o=0;t&&t.valueLocale?d.innerHTML=r.formFinal(t):(n=ui.d.getElementById("label"),n&&(n.innerHTML="תשלום בוצע בהצלחה. לסיום ההזמנה צפי בסרטון ומלאי שאלון",o=3500),setTimeout(function(){i&&i!==a||(d.innerHTML=r.formStart())},o))},e.valueLocale={bright:"את בעלת צבעים בהירים",clear:"את בעלת צבעים צלולים",cold:"את בעלת צבעים קרים",deep:"את בעלת צבעים עמוקים",mixed:"את בעלת צבעים מעורבים",warm:"את בעלת צבעים חמים"},e.uniqueID=function(){return Math.random().toString(16).substr(2,8)},e.formStart=function(){var i=e;return i.template={option:[{title:"האם צבע השיער שלך שחור או חום כהה?",option:[{title:"העיניים שלך מבריקות, בולטות, בצבע ירוק כהה, ירוק זית? האם יש קונטראסט בין הלבן בעיניים לבין האישון?","final":"clear"},{title:"העיניים שלך בצבע חום כהה?","final":"deep"},{title:"העיניים שלך בהירות, בצבע כחול, ירוק בהיר או אפור בהיר?","final":"bright"}]},{title:"האם צבע השיער שלך בלונד בהיר, אפור בהיר, חום בהיר?",option:[{title:"העיניים שלך בהירות בצבעים כחול, אפור או ירוק בהיר?","final":"bright"},{title:"העיניים שלך בצבע חום בהיר, מתמזגות עם צבע השיער?","final":"mixed"}]},{title:"האם צבע השיער שלך חום בינוני או עכברי, אפור בינוני, בלונד אפורי, בלונד כהה?",option:[{title:"העיניים שלך בהירות בצבעים כחול בהיר, אפור או ירוק בהיר?","final":"bright"},{title:"העיניים שלך חום בהיר, מתמזג עם צבע השיער?","final":"mixed"}]},{title:"האם צבע השיער שלך ג'ינג'י, דבש, ערמוני, והעיניים שלך ירוק חם כהה, חום ירקרק, חום דבש, כחול ירוק?","final":"warm"},{title:"האם צבע השיער שלך חום אפרפר (עכברי), בלונדי-אפרורי, כסוף, שיבה אפור, והצבע העיניים שלך כחול או חום או ירקרק?","final":"cold"}]},i.getIcon=function(e){return"<svg class=icon-"+e+"><use xlink:href=#"+e+" /></svg>"},i.label=function(e,t,n){var r,a,o,l=t!==!1,c="";if(t=t||0,l&&!n&&(t+=1),e){if(l&&(r=!e.option,o=!r&&i.uniqueID(),c+=(n?"":"<ol>")+"<li><input type=radio name="+t+(o?" id="+o:"")+"><label onclick="+(e["final"]?'"ui.formDialog(event, '+t+", '"+e["final"]+"')\"":"ui.formClick(event) for="+o)+"><div class=checkbox></div>"+e.title+"</label>"),Array.isArray(e.option)){t+=1,c+="<ol>";for(a in e.option)e.option.hasOwnProperty(a)&&(c+=i.label(e.option[a],t,!0));c+="</ol>"}else e.option&&(c+=i.label(e.option,t));l&&(c+="</li>"+(n?"":"</ol>"))}return c},ui.formClick=function(e){var t,i,n,r,a="LABEL"===e.target.tagName?e.target:e.target.closest("label"),o="true"===a.getAttribute("data-active");if(o){for(e.preventDefault(),i=a.parentNode.querySelectorAll("[data-active]"),n=0;n<i.length;n+=1)i[n].removeAttribute("data-active");for(i=a.parentNode.querySelectorAll("input:checked"),n=0;n<i.length;n+=1)i[n].checked=!1}else a.setAttribute("data-active","true");for(i=a.parentNode.parentNode.children,n=0;n<i.length;n+=1)if(o||i[n]!==a.parentNode)for(t=i[n].querySelectorAll("label"),r=0;r<t.length;r+=1)o?t[r].removeAttribute("disabled"):t[r].setAttribute("disabled","");else a.removeAttribute("disabled")},ui.formDialog=function(e,t,n,r){var a=r||e.target,o=i.valueLocale[n],l="";return!r&&e&&ui.formClick(e),a&&o&&(l+="<div class=dialog>   <div class=table>   <div class=cel>       <div class=close onclick=ui.formReset(this) tabindex=0>"+i.getIcon("close")+"</div>       <h1>"+o+"</h1>       <button onclick=\"ui.formSubmit(this, '"+n+"')\">אישור</button>   </div>   </div></div>",r||(a=1===t?a.parentNode:a.parentNode.parentNode.parentNode,a.insertAdjacentHTML("afterbegin",l))),l},ui.formReset=function(e){e&&e.parentNode.parentNode.parentNode.remove();var t,i=ui.d.querySelectorAll(".qa [disabled]");for(t=0;t<i.length;t+=1)i[t].removeAttribute("disabled");for(i=ui.d.querySelectorAll(".qa input:checked"),t=0;t<i.length;t+=1)i[t].checked=!1;for(i=ui.d.querySelectorAll(".qa [data-active]"),t=0;t<i.length;t+=1)i[t].removeAttribute("data-active")},ui.formSubmit=function(t,i){u.classList.remove("no-padding"),d.innerHTML=ui.pageProgress;var n=ui.d.getElementById("label");n&&(n.innerHTML="סיום"),r(function(t,n){fetch(s+"/payment/update",{method:"POST",redirect:"error",signal:t,body:JSON.stringify({transaction:c.transaction,value:i,url:location.href})}).then(function(e){return 200===e.status?n===a&&e.json():Promise.reject(new Error("Failed to fetch"))}).then(function(e){return e.error?Promise.reject(e):e}).then(function(t){e(t,n)})["catch"](function(e){n===a&&o("תקלה בשרת, בבקשה <a href=/contacts>תצרי קשר</a> להמשך טיפול הזמנה",e)})})},u.classList.add("no-padding"),t=!0,'<div class=absolute><div class="table">    <div class=cel><p>תשלום בוצע בהצלחה. לסיום ההזמנה צפי בסרטון ומלאי שאלון</p></div></div></div><div class=video dir=ltr>    <iframe title="ערכת &quot;צבע מבפנים&quot;" src="https://www.youtube.com/embed/ihxGT0A1OrE" allow="autoplay; encrypted-media; fullscreen" allowfullscreen></iframe></div><div class="content form qa" dir=rtl>    <h1 id=title>'+ui.d.title+"</h1>    <div class=figure>"+i.label(i.template,!1)+"</div></div>"},e.formFinal=function(i){var n="",r="";return i.valueLocale?(i.modified&&(r=new Date(i.modified),r=r.getDate()+"/"+r.getMonth()+"/"+r.getFullYear(),r="<time>ההזמנה בוצע ב"+r+"</time>"),u.classList.remove("no-padding"),t=!1,n+='<div class="dialog final">   <div class=table>   <div class=cel>   <div class=context>       <h1>'+i.valueLocale+"</h1>       <p>"+(i.descriptionLocale||"").replace(/\n/g,"<br>")+"</p>"+r+"   </div>   </div>   </div></div>"):n+=e(),n},ui.w.addEventListener("hashchange",l),ui.w.addEventListener("beforeunload",function(e){return t?(e.preventDefault(),e.returnValue="תהליך ההזמנה לא הסתיים, ברצונך לסגור כעט?",e.returnValue):void 0}),ui.w.addEventListener("unload",function(){t&&navigator.sendBeacon(s+"/payment/reminder",JSON.stringify({transaction:i,url:location.href}))}),l()});