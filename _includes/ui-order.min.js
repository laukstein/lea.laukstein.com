ui.order=ui.legacy(function(){"use strict";var i,s,c,r,u,l,n,d=function(){for(var e=location.hostname.split(".");2<e.length;)e.shift();return"https://lab."+e.join(".")+"/webhook"}(),m=ui.d.querySelector(".table.scale"),f=ui.d.getElementById("status"),h={},v={};return v.toContact=" לשאלות אנא <a href=/contact>צרי קשר</a>",Object.assign(v,{notFound:"הזמנה זו לא נמצאה."+v.toContact,notPermitted:"פעולה לא מאושרת."+v.toContact,networkError:"ישנה תקלה בשרת."+v.toContact,networkOutage:"ישנה תקלה זמנית בשרת. אנא נסי שוב מאוחר יותר",unauthorized:"גישה רק ללקוחות <a href=/colour>"+ui.d.title+"</a>",accessRevoked:"גישה לדף זה מורשית רק דרך דף התשלום",paymentSuccess:"תשלום בוצע בהצלחה. לסיום ההזמנה צפי בסרטון ומלאי את השאלון",serverError:"ישנה תקלה בשרת, אנא <a href=/contacts>צרי קשר</a> להמשך הטיפול בהזמנה",incompleteSubmission:"תהליך ההזמנה לא הסתיים, האם ברצונך לסגור כעט?"}),(u=function(e){var t;delete ui.inProgress,ui.w.AbortController&&(r&&r.abort(),t=(r=new AbortController).signal),"function"==typeof e&&e(t,l=i.uniqueID())}).onError=function(e,t){if(t=t||{},delete ui.inProgress,"AbortError"!==t.name){switch(console.warn(n),m.classList.remove("no-padding"),t.message){case"notFound":case"notPermitted":case"serverError":console.error(t.message),e=v[t.message];break;case"Failed to fetch":console.error(t.message),e=v.networkOutage;break;case"NetworkError when attempting to fetch resource.":console.error(t.message),e=v.networkError}console.trace&&console.trace(),s=!1,f.innerHTML='<div class="table center">    <div class=cel>        <div class=error>'+e+"</div>    </div></div>",r&&r.abort()}},u.verifyStatus=function(e,t,r){switch(e.status){case 200:return t===l&&e.json();case 400:return Promise.reject(new Error(r));case 503:return Promise.reject(new Error("serverError"));default:return Promise.reject(new Error("Failed to fetch"))}},h.getData=function(){var t,r,e;return m.classList.remove("no-padding"),l=void 0,ui.pageProgress=ui.pageProgress||f.innerHTML,f.innerHTML=ui.pageProgress,i.timer&&clearTimeout(i.timer),e=function(){return s=!1,location.hash&&(n=ui.hash(),c=n.transaction)?(u(function(e,t){fetch(d+"/payment/order",{method:"POST",redirect:"error",signal:e,body:JSON.stringify({transaction:c})}).then(function(e){return u.verifyStatus(e,t,"notFound")}).then(function(e){return e.error?Promise.reject(e):e}).then(function(e){i(e,t)}).catch(function(e){t===l&&u.onError(v.notFound,e)})}),!0):(u.onError(v.unauthorized),!1)},location.search?(console.log(location.href),n=ui.hash({hash:location.search}),t=["orderid","service","transaction","amount","email","phone","firstname","lastname","startDate","utm_campaign","utm_source"],r=function(e){e&&e!==c&&(c=e,history.replaceState&&history.replaceState("",ui.d.title,location.pathname+"#transaction="+c))},n.custom&&(Object.assign(n,ui.hash({hash:atob(n.custom)})),delete n.custom),n.index&&(n.transaction=n.index,delete n.index),n.email&&(n.email=n.email.toLowerCase(),ui.setUser(ui.filterObj({email:n.email,tel:n.phone,firstName:n.firstname,lastName:n.lastname},function(e,t){return!!t[e]}))),n.transaction&&r(btoa(n.transaction)),n.token===ui.cookie("paymentToken")&&n.orderid&&n.email&&n.transaction?(n=ui.filterObj(n,function(e){return t.includes(e)}),u(function(e,t){fetch(d+"/payment/register",{method:"POST",redirect:"error",signal:e,body:JSON.stringify(n)}).then(function(e){return u.verifyStatus(e,t,"notPermitted")}).then(function(e){r(e.transaction),i(e,t)}).catch(function(e){t===l&&u.onError(v.accessRevoked,e)})})):e()):e(),n},h.alert=function(e){if(s)return e.preventDefault(),e.returnValue=v.incompleteSubmission,e.returnValue},h.remind=function(){s&&h.remind.done!==c&&(h.remind.done=c,navigator.sendBeacon&&navigator.sendBeacon(d+"/payment/reminder",JSON.stringify({transaction:c,url:location.href})))},(i=function(e,t){var r,n=i,o=ui.d.getElementById("content"),a=0;e&&e.valueLocale?o?o.outerHTML=n.formFinal(e):f.innerHTML=n.formFinal(e,"color-swatch"===e.service):((r=ui.d.getElementById("label"))&&(r.innerHTML=v.paymentSuccess,a=3500),n.timer=setTimeout(function(){t&&t!==l||(f.innerHTML=n.formStart(),n.addEvents(),ui.video.applyPlyr())},a))}).valueLocale={bright:"את בעלת צבעים בהירים",clear:"את בעלת צבעים צלולים",cold:"את בעלת צבעים קרים",deep:"את בעלת צבעים עמוקים",mixed:"את בעלת צבעים מעורבים",warm:"את בעלת צבעים חמים"},i.video='<div class=video dir=ltr>    <iframe title="ערכת &quot;צבע מבפנים&quot;" src="https://www.youtube.com/embed/ihxGT0A1OrE" allow="autoplay; encrypted-media; fullscreen" allowfullscreen></iframe></div>',i.uniqueID=function(){return Math.random().toString(16).substr(2,8)},i.formStart=function(){var e,t,r,n,o,a=i;return s=!0,a.template={hair:{title:"באיזה צבע השיער שלך?",placeholder:"לבחור צבע השיער",option:{black:"שחור",darkBrown:"חום כהה",mediumBrown:"חום בינוני",lightBrown:"חום בהיר",honey:"דבש",brightBlond:"בלונד בהיר",darkBlond:"בלונד כהה",redhead:"ג'ינג'י",chestnut:"ערמוני",blondeGray:"בלונד אפור",lightGray:"אפור בהיר",mediumGray:"אפור בינוני",grayGray:"שיבה אפור",mousey:"עכברי",silver:"כסוף"}},eyes:{title:"באיזה צבע העיניים שלך?",placeholder:"לבחור צבע העיניים",option:{brown:"חום",darkBrown:"חום כהה",honeyBrown:"חום דבש",greenishBrown:"חום ירקרק",lightGray:"אפור בהיר",greenish:"ירקרק",brightGreen:"ירוק בהיר",oliveGreen:"ירוק זית",darkGreen:"ירוק כהה",blue:"כחול",lightBlue:"כחול בהיר",blueGreen:"כחול ירוק"}},skin:{title:"מה גוון העור שלך?",placeholder:"לבחור גוון העור",option:{tan:"שזוף",bright:"בהיר",dark:"כהה"}}},a.value={},a.button="אשר הזמנה",a.form=function(e){var t,r,n="";for(t in n+="<ul>",e)if(Object.prototype.hasOwnProperty.call(e,t)){for(r in n+="<li><h3>"+e[t].title+"</h3><select name="+t+' required>    <option class=placeholder value="">'+e[t].placeholder+"</option>",e[t].option)Object.prototype.hasOwnProperty.call(e[t].option,r)&&(n+="    <option value="+r+">"+e[t].option[r]+"</option>");n+="</select></li>"}return'<form class="unselectable form cs" name=cs method=post novalidate>'+(n+="</ul><button>"+a.button+"</button>")+"</form>"},a.addEvents=function(){ui.d.forms.cs.addEventListener("submit",a.addEvents.submit),Object.keys(a.template).forEach(function(e){ui.d.forms.cs[e].addEventListener("change",a.addEvents.change)})},a.addEvents.submit=function(e){var t,r=ui.d.getElementById("content"),n=+new Date,o=!0;e.preventDefault(),Object.keys(a.template).forEach(function(e){a.value[e]||(o=!1,ui.d.forms.cs[e].classList.add("error"))}),o?(r&&(r.innerHTML=ui.pageProgress,(t=ui.d.getElementById("label"))&&(t.innerHTML="סיום הזמנה")),u(function(e,t){ui.inProgress=!0,fetch(d+"/payment/update",{method:"POST",redirect:"error",signal:e,body:JSON.stringify({transaction:c,service:"color-swatch",value:JSON.stringify(a.value),url:location.href})}).then(function(e){return u.verifyStatus(e,t,"notPermitted")}).then(function(e){return e.error?Promise.reject(e):e}).then(function(e){a.timer=setTimeout(function(){i(e,t),delete ui.inProgress},2500-(new Date-n)||0)}).catch(function(e){t===l&&u.onError(v.serverError,e)})})):console.warn("Incomplete submission")},a.addEvents.change=function(e){var t=e.target;t.value?a.value[t.name]=t.value:delete a.value[t.name],a.value=Object.keys(a.value).sort().reduce(function(e,t){return e[t]=a.value[t],e},{}),t.value&&t.classList.remove("error"),console.log(a.value)},e=function(){var e,t=!1;try{e=Object.defineProperty({},"passive",{get:function(){return t=!0}}),addEventListener("test",e,e),removeEventListener("test",e,e)}catch(e){t=!1}return!t||{passive:!0}}(),n=setInterval(function(){s||o(),60<=Math.round((new Date-t)/6e4)&&(o(),h.remind())},24e4),r=function(){s&&(t=new Date)},o=function(){n&&(ui.w.removeEventListener("pointerdown",r,e),ui.w.removeEventListener("pointermove",r,e),clearTimeout(n),n=void 0)},ui.w.addEventListener("pointerdown",r,e),ui.w.addEventListener("pointermove",r,e),m.classList.add("no-padding"),a.video+"<div class=content id=content dir=rtl>    <h1 id=title>"+ui.d.title+"</h1>"+a.form(a.template)+'    <div class="figure footer">        <div class=notice>לא בטוחה לאלו צבעים את שייכת?<br>שלחי לי תמונת פנים ברורה שצולמה באור היום לוואטסאפ <a href="https://wa.me/972585800020" target=_blank dir=auto>0585800020</a> או למייל <a href="mailto:lea@laukstein.com" target=_blank dir=auto>lea@laukstein.com</a></div>    </div></div>'},i.formFinal=function(e,t){var r=i,n="",o="";return e.valueLocale?(e.date&&(o="<time>ההזמנה בוצעה ב "+(o=(o=new Date(1e3*e.date)).getDate()+"/"+o.getMonth()+"/"+o.getFullYear())+"</time>"),s=!1,n+=(t?r.video:"")+"<div class="+("color-swatch"===e.service?"content":'"content center"')+">   <h1>"+e.valueLocale+"</h1>   <p>"+(e.descriptionLocale||"").replace(/\n/g,"<br>")+"</p>"+o+"</div>"):n+=i(),n},ui.w.addEventListener("hashchange",h.getData),ui.w.addEventListener("beforeunload",h.alert),ui.w.addEventListener("unload",h.remind),h.getData()});