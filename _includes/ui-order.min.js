ui.order=ui.legacy(function(){"use strict";var e,t,r,n,o,i,a,s=function(){for(var e=location.hostname.split(".");e.length>2;)e.shift();return"https://lab."+e.join(".")+"/webhook"}(),c=ui.d.querySelector(".table.scale"),u=ui.d.getElementById("status"),l={},d={};return d.toContact=" לשאלות אנא <a href=/contact>צרי קשר</a>",Object.assign(d,{notFound:"הזמנה זו לא נמצאה."+d.toContact,notPermitted:"פעולה לא מאושרת."+d.toContact,networkError:"ישנה תקלה בשרת."+d.toContact,networkOutage:"ישנה תקלה זמנית בשרת. אנא נסי שוב מאוחר יותר",unauthorized:"גישה רק ללקוחות <a href=/colour>"+ui.d.title+"</a>",accessRevoked:"גישה לדף זה מורשית רק דרך דף התשלום",paymentSuccess:"תשלום בוצע בהצלחה. לסיום ההזמנה צפי בסרטון ומלאי את השאלון",serverError:"ישנה תקלה בשרת, אנא <a href=/contacts>צרי קשר</a> להמשך הטיפול בהזמנה",incompleteSubmission:"תהליך ההזמנה לא הסתיים, האם ברצונך לסגור כעט?"}),o=function(t){var r;delete ui.inProgress,ui.w.AbortController&&(n&&n.abort(),n=new AbortController,r=n.signal),"function"==typeof t&&(i=e.uniqueID(),t(r,i))},o.onError=function(e,r){if(r=r||{},delete ui.inProgress,"AbortError"!==r.name){switch(console.warn(a),c.classList.remove("no-padding"),r.message){case"notFound":case"notPermitted":case"serverError":console.error(r.message),e=d[r.message];break;case"Failed to fetch":console.error(r.message),e=d.networkOutage;break;case"NetworkError when attempting to fetch resource.":console.error(r.message),e=d.networkError}t=!1,u.innerHTML='<div class="table center">    <div class=cel>        <div class=error>'+e+"</div>    </div></div>",n&&n.abort()}},o.verifyStatus=function(e,t,r){switch(e.status){case 200:return t===i&&e.json();case 400:return Promise.reject(new Error(r));case 503:return Promise.reject(new Error("serverError"));default:return Promise.reject(new Error("Failed to fetch"))}},l.getData=function(){var n,l,m;return c.classList.remove("no-padding"),i=void 0,ui.pageProgress=ui.pageProgress||u.innerHTML,u.innerHTML=ui.pageProgress,e.timer&&clearTimeout(e.timer),m=function(){return t=!1,location.hash&&(a=ui.hash(),r=a.transaction)?(o(function(t,n){fetch(s+"/payment/order",{method:"POST",redirect:"error",signal:t,body:JSON.stringify({transaction:r})}).then(function(e){return o.verifyStatus(e,n,"notFound")}).then(function(e){return e.error?Promise.reject(e):e}).then(function(t){e(t,n)})["catch"](function(e){n===i&&o.onError(d.notFound,e)})}),!0):(o.onError(d.unauthorized),!1)},location.search?(a=ui.hash({hash:location.search}),n=["orderid","service","transaction","amount","email","phone","firstname","lastname","startDate","utm_campaign","utm_source"],l=function(e){e&&e!==r&&(r=e,history.replaceState&&history.replaceState("",ui.d.title,location.pathname+"#transaction="+r))},a.custom&&(Object.assign(a,ui.hash({hash:atob(a.custom)})),delete a.custom),a.index&&(a.transaction=a.index,delete a.index),a.email&&(a.email=a.email.toLowerCase(),ui.setUser(ui.filterObj({email:a.email,tel:a.phone,firstName:a.firstname,lastName:a.lastname},function(e,t){return!!t[e]}))),a.transaction&&l(btoa(a.transaction)),a.token===sessionStorage.paymentToken&&a.orderid&&a.email&&a.transaction?(a=ui.filterObj(a,function(e){return n.includes(e)}),o(function(t,r){fetch(s+"/payment/register",{method:"POST",redirect:"error",signal:t,body:JSON.stringify(a)}).then(function(e){return o.verifyStatus(e,r,"notPermitted")}).then(function(t){l(t.transaction),e(t,r)})["catch"](function(e){r===i&&o.onError(d.accessRevoked,e)})})):m()):m(),a},l.alert=function(e){return t?(e.preventDefault(),e.returnValue=d.incompleteSubmission,e.returnValue):void 0},l.remind=function(){t&&l.remind.done!==r&&(l.remind.done=r,navigator.sendBeacon(s+"/payment/reminder",JSON.stringify({transaction:r,url:location.href})))},e=function(t,r){var n,o=e,a=ui.d.getElementById("content"),s=0;t&&t.valueLocale?a?a.outerHTML=o.formFinal(t):u.innerHTML=o.formFinal(t,"color-swatch"===t.service):(n=ui.d.getElementById("label"),n&&(n.innerHTML=d.paymentSuccess,s=3500),o.timer=setTimeout(function(){r&&r!==i||(u.innerHTML=o.formStart(),o.addEvents(),ui.video.applyPlyr())},s))},e.valueLocale={bright:"את בעלת צבעים בהירים",clear:"את בעלת צבעים צלולים",cold:"את בעלת צבעים קרים",deep:"את בעלת צבעים עמוקים",mixed:"את בעלת צבעים מעורבים",warm:"את בעלת צבעים חמים"},e.video='<div class=video dir=ltr>    <iframe title="ערכת &quot;צבע מבפנים&quot;" src="https://www.youtube.com/embed/ihxGT0A1OrE" allow="autoplay; encrypted-media; fullscreen" allowfullscreen></iframe></div>',e.uniqueID=function(){return Math.random().toString(16).substr(2,8)},e.formStart=function(){var n=e;return t=!0,n.template={hair:{title:"באיזה צבע השיער שלך?",placeholder:"לבחור צבע השיער",option:{black:"שחור",darkBrown:"חום כהה",mediumBrown:"חום בינוני",lightBrown:"חום בהיר",honey:"דבש",brightBlond:"בלונד בהיר",darkBlond:"בלונד כהה",redhead:"ג'ינג'י",chestnut:"ערמוני",blondeGray:"בלונד אפור",lightGray:"אפור בהיר",mediumGray:"אפור בינוני",grayGray:"שיבה אפור",mousey:"עכברי",silver:"כסוף"}},eyes:{title:"באיזה צבע העיניים שלך?",placeholder:"לבחור צבע העיניים",option:{brown:"חום",darkBrown:"חום כהה",honeyBrown:"חום דבש",greenishBrown:"חום ירקרק",lightGray:"אפור בהיר",greenish:"ירקרק",brightGreen:"ירוק בהיר",oliveGreen:"ירוק זית",darkGreen:"ירוק כהה",blue:"כחול",lightBlue:"כחול בהיר",blueGreen:"כחול ירוק"}},skin:{title:"מה גוון העור שלך?",placeholder:"לבחור גוון העור",option:{tan:"שזוף",bright:"בהיר",dark:"כהה"}}},n.value={},n.button="אשר הזמנה",n.form=function(e){var t,r,o="";o+="<ul>";for(t in e)if(e.hasOwnProperty(t)){o+="<li><h3>"+e[t].title+"</h3><select name="+t+' required>    <option class=placeholder value="">'+e[t].placeholder+"</option>";for(r in e[t].option)e[t].option.hasOwnProperty(r)&&(o+="    <option value="+r+">"+e[t].option[r]+"</option>");o+="</select></li>"}return o+="</ul><button>"+n.button+"</button>",'<form class="unselectable form cs" name=cs method=post novalidate>'+o+"</form>"},n.addEvents=function(){ui.d.forms.cs.addEventListener("submit",n.addEvents.submit),Object.keys(n.template).forEach(function(e){ui.d.forms.cs[e].addEventListener("change",n.addEvents.change)})},n.addEvents.submit=function(t){var a,c=ui.d.getElementById("content"),u=+new Date,l=!0;t.preventDefault(),Object.keys(n.template).forEach(function(e){n.value[e]||(l=!1,ui.d.forms.cs[e].classList.add("error"))}),l?(c&&(c.innerHTML=ui.pageProgress,a=ui.d.getElementById("label"),a&&(a.innerHTML="סיום הזמנה")),o(function(t,a){ui.inProgress=!0,fetch(s+"/payment/update",{method:"POST",redirect:"error",signal:t,body:JSON.stringify({transaction:r,service:"color-swatch",value:JSON.stringify(n.value),url:location.href})}).then(function(e){return o.verifyStatus(e,a,"notPermitted")}).then(function(e){return e.error?Promise.reject(e):e}).then(function(t){n.timer=setTimeout(function(){e(t,a),delete ui.inProgress},2500-(+new Date-u)||0)})["catch"](function(e){a===i&&o.onError(d.serverError,e)})})):console.warn("Incomplete submission")},n.addEvents.change=function(e){var t=e.target;t.value?n.value[t.name]=t.value:delete n.value[t.name],n.value=Object.keys(n.value).sort().reduce(function(e,t){return e[t]=n.value[t],e},{}),t.value&&t.classList.remove("error"),console.log(n.value)},function(){var e,r,n,o,i;e=function(){var e,t=!1;try{e=Object.defineProperty({},"passive",{get:function(){return t=!0}}),addEventListener("test",e,e),removeEventListener("test",e,e)}catch(r){t=!1}return t?{passive:!0}:!0}(),o=setInterval(function(){t||i(),Math.round((new Date-r)/6e4)>=60&&(i(),l.remind())},24e4),n=function(){t&&(r=new Date)},i=function(){o&&(ui.w.removeEventListener("pointerdown",n,e),ui.w.removeEventListener("pointermove",n,e),clearTimeout(o),o=void 0)},ui.w.addEventListener("pointerdown",n,e),ui.w.addEventListener("pointermove",n,e)}(),c.classList.add("no-padding"),n.video+"<div class=content id=content dir=rtl>    <h1 id=title>"+ui.d.title+"</h1>"+n.form(n.template)+'    <div class="figure footer">        <div class=notice>לא בטוחה לאלו צבעים את שייכת?<br>שלחי לי תמונת פנים ברורה שצולמה באור היום לוואטסאפ <a href="https://wa.me/972585800020" target=_blank dir=auto>0585800020</a> או למייל <a href="mailto:lea@laukstein.com" target=_blank dir=auto>lea@laukstein.com</a></div>    </div></div>'},e.formFinal=function(r,n){var o=e,i="",a="";return r.valueLocale?(r.date&&(a=new Date(1e3*r.date),a=a.getDate()+"/"+a.getMonth()+"/"+a.getFullYear(),a="<time>ההזמנה בוצעה ב "+a+"</time>"),t=!1,i+=(n?o.video:"")+"<div class="+("color-swatch"===r.service?"content":'"content center"')+">   <h1>"+r.valueLocale+"</h1>   <p>"+(r.descriptionLocale||"").replace(/\n/g,"<br>")+"</p>"+a+"</div>"):i+=e(),i},ui.w.addEventListener("hashchange",l.getData),ui.w.addEventListener("beforeunload",l.alert),ui.w.addEventListener("unload",l.remind),l.getData()});