ui.order=ui.legacy(function(){"use strict";var e,t,r,n,i,o,a,l=function(){for(var e=location.host.split(".");e.length>2;)e.shift();return"https://lab."+e.join(".")+"/webhook"}(),c=ui.d.querySelector(".table.scale"),u=ui.d.getElementById("status"),s={},d={};return d.toContact=" לשאלות אנא <a href=/contact>צרי קשר</a>",Object.assign(d,{notFound:"הזמנה זו לא נמצאה."+d.toContact,notPermitted:"פעולה לא מאושרת."+d.toContact,networkError:"ישנה תקלה בשרת."+d.toContact,networkOutage:"ישנה תקלה זמנית בשרת. אנא נסי שוב מאוחר יותר",unauthorized:"גישה רק ללקוחות <a href=/colour>"+ui.d.title+"</a>",accessRevoked:"גישה לדף זה מורשית רק דרך דף התשלום",paymentSuccess:"תשלום בוצע בהצלחה. לסיום ההזמנה צפי בסרטון ומלאי את השאלון",serverError:"ישנה תקלה בשרת, אנא <a href=/contacts>צרי קשר</a> להמשך הטיפול בהזמנה",incompleteSubmission:"תהליך ההזמנה לא הסתיים, האם ברצונך לסגור כעט?"}),i=function(t){var r;ui.w.AbortController&&(n&&n.abort(),n=new AbortController,r=n.signal),"function"==typeof t&&(o=e.uniqueID(),t(r,o))},i.onError=function(e,r){if(r=r||{},"AbortError"!==r.name){switch(console.warn(a),c.classList.remove("no-padding"),r.message){case"notFound":case"notPermitted":case"serverError":console.error(r.message),e=d[r.message];break;case"Failed to fetch":console.error(r.message),e=d.networkOutage;break;case"NetworkError when attempting to fetch resource.":console.error(r.message),e=d.networkError}t=!1,u.innerHTML='<div class="table center">    <div class=cel>        <div class=error>'+e+"</div>    </div></div>",n&&n.abort()}},i.verifyStatus=function(e,t,r){switch(e.status){case 200:return t===o&&e.json();case 400:return Promise.reject(new Error(r));case 503:return Promise.reject(new Error("serverError"));default:return Promise.reject(new Error("Failed to fetch"))}},s.getData=function(){var n,s;return c.classList.remove("no-padding"),o=void 0,ui.pageProgress=ui.pageProgress||u.innerHTML,u.innerHTML=ui.pageProgress,e.timer&&clearTimeout(e.timer),s=function(){return t=!1,location.hash&&(a=ui.hash(),r=a.transaction)?(i(function(t,n){fetch(l+"/payment/order",{method:"POST",redirect:"error",signal:t,body:JSON.stringify({transaction:r})}).then(function(e){return i.verifyStatus(e,n,"notFound")}).then(function(e){return e.error?Promise.reject(e):e}).then(function(t){e(t,n)})["catch"](function(e){n===o&&i.onError(d.notFound,e)})}),!0):(i.onError(d.unauthorized),!1)},location.search?(a=ui.hash({hash:location.search}),n=["orderid","transaction","email","phone","firstname","lastname","utm_source","utm_campaign"],a.custom&&(Object.assign(a,ui.hash({hash:atob(a.custom)})),delete a.custom),a.index&&(a.transaction=a.index,delete a.index),a.email&&(a.email=a.email.toLowerCase(),ui.setUser(ui.filterObj({email:a.email,tel:a.phone,firstName:a.firstname,lastName:a.lastname},function(e,t){return!!t[e]}))),a.token===sessionStorage.paymentToken&&a.orderid&&a.email&&a.transaction?(a=ui.filterObj(a,function(e){return n.includes(e)}),i(function(t,n){fetch(l+"/payment/register",{method:"POST",redirect:"error",signal:t,body:JSON.stringify(a)}).then(function(e){return i.verifyStatus(e,n,"notPermitted")}).then(function(t){r=t.transaction,history.replaceState&&history.replaceState("",ui.d.title,location.pathname+"#transaction="+r),e(t,n)})["catch"](function(e){n===o&&i.onError(d.accessRevoked,e)})})):s()):s(),a},s.alert=function(e){return t?(e.preventDefault(),e.returnValue=d.incompleteSubmission,e.returnValue):void 0},s.remind=function(){t&&s.remind.done!==r&&(s.remind.done=r,navigator.sendBeacon(l+"/payment/reminder",JSON.stringify({transaction:r,url:location.href})))},e=function(t,r){var n,i=e,a=ui.d.getElementById("content"),l=0;t&&t.valueLocale?a?a.outerHTML=i.formFinal(t):u.innerHTML=i.formFinal(t,!0):(n=ui.d.getElementById("label"),n&&(n.innerHTML=d.paymentSuccess,l=3500),i.timer=setTimeout(function(){r&&r!==o||(u.innerHTML=i.formStart(),ui.video.applyPlyr())},l))},e.valueLocale={bright:"את בעלת צבעים בהירים",clear:"את בעלת צבעים צלולים",cold:"את בעלת צבעים קרים",deep:"את בעלת צבעים עמוקים",mixed:"את בעלת צבעים מעורבים",warm:"את בעלת צבעים חמים"},e.video='<div class=video dir=ltr>    <iframe title="ערכת &quot;צבע מבפנים&quot;" src="https://www.youtube.com/embed/ihxGT0A1OrE" allow="autoplay; encrypted-media; fullscreen" allowfullscreen></iframe></div>',e.uniqueID=function(){return Math.random().toString(16).substr(2,8)},e.formStart=function(){var n=e;return t=!0,n.template={option:[{title:"האם צבע השיער שלך שחור או חום כהה?",option:[{title:"העיניים שלך מבריקות, בולטות, בצבע ירוק כהה, ירוק זית? האם יש קונטראסט בין הלבן בעיניים לבין האישון?","final":"clear"},{title:"העיניים שלך בצבע חום כהה?","final":"deep"},{title:"העיניים שלך בהירות, בצבע כחול, ירוק בהיר או אפור בהיר?","final":"bright"}]},{title:"האם צבע השיער שלך בלונד בהיר, אפור בהיר, חום בהיר?",option:[{title:"העיניים שלך בהירות בצבעים כחול, אפור או ירוק בהיר?","final":"bright"},{title:"העיניים שלך בצבע חום בהיר, מתמזגות עם צבע השיער?","final":"mixed"}]},{title:"האם צבע השיער שלך חום בינוני או עכברי, אפור בינוני, בלונד אפורי, בלונד כהה?",option:[{title:"העיניים שלך בהירות בצבעים כחול בהיר, אפור או ירוק בהיר?","final":"bright"},{title:"העיניים שלך חום בהיר, מתמזג עם צבע השיער?","final":"mixed"}]},{title:"האם צבע השיער שלך ג'ינג'י, דבש, ערמוני, והעיניים שלך ירוק חם כהה, חום ירקרק, חום דבש, כחול ירוק?","final":"warm"},{title:"האם צבע השיער שלך חום אפרפר (עכברי), בלונדי-אפרורי, כסוף, שיבה אפור, והצבע העיניים שלך כחול או חום או ירקרק?","final":"cold"}]},n.getIcon=function(e){return"<svg class=icon-"+e+"><use xlink:href=#"+e+" /></svg>"},n.label=function(e,t,r){var i,o,a,l=t!==!1,c="";if(t=t||0,l&&!r&&(t+=1),e){if(l&&(i=!e.option,a=!i&&n.uniqueID(),c+=(r?"":"<ol>")+"<li><input type=radio name="+t+(a?" id="+a:"")+"><label onclick="+(e["final"]?'"ui.formDialog(event, '+t+", '"+e["final"]+"')\"":"ui.formClick(event) for="+a)+"><div class=checkbox></div>"+e.title+"</label>"),Array.isArray(e.option)){t+=1,c+="<ol>";for(o in e.option)e.option.hasOwnProperty(o)&&(c+=n.label(e.option[o],t,!0));c+="</ol>"}else e.option&&(c+=n.label(e.option,t));l&&(c+="</li>"+(r?"":"</ol>"))}return c},ui.formClick=function(e){var t,r,n,i,o=e.currentTarget,a="true"===o.getAttribute("data-active");if(a){for(e.preventDefault(),r=o.parentNode.querySelectorAll("[data-active]"),n=0;n<r.length;n+=1)r[n].removeAttribute("data-active");for(r=o.parentNode.querySelectorAll("input:checked"),n=0;n<r.length;n+=1)r[n].checked=!1}else o.setAttribute("data-active","true");for(r=o.parentNode.parentNode.children,n=0;n<r.length;n+=1)if(a||r[n]!==o.parentNode)for(t=r[n].querySelectorAll("label"),i=0;i<t.length;i+=1)a?t[i].removeAttribute("disabled"):t[i].setAttribute("disabled","");else o.removeAttribute("disabled")},ui.formDialog=function(e,t,r){var i=e.currentTarget,o=n.valueLocale[r],a="";return ui.formClick(e),i&&o&&(a+="<div class=dialog>   <div class=table>   <div class=cel id=result>       <div class=close onclick=ui.formReset(this) tabindex=0>"+n.getIcon("close")+"</div>       <h1>"+o+"</h1>       <button onclick=\"ui.formSubmit(this, '"+r+"')\">אישור</button>   </div>   </div></div>",i=1===t?i.parentNode:i.parentNode.parentNode.parentNode,i.insertAdjacentHTML("afterbegin",a)),a},ui.formReset=function(e){e&&e.parentNode.parentNode.parentNode.remove();var t,r=ui.d.querySelectorAll(".qa [disabled]");for(t=0;t<r.length;t+=1)r[t].removeAttribute("disabled");for(r=ui.d.querySelectorAll(".qa input:checked"),t=0;t<r.length;t+=1)r[t].checked=!1;for(r=ui.d.querySelectorAll(".qa [data-active]"),t=0;t<r.length;t+=1)r[t].removeAttribute("data-active")},ui.formSubmit=function(t,a){var c,u=ui.d.getElementById("result"),s=+new Date;u&&(u.innerHTML=ui.pageProgress,c=ui.d.getElementById("label"),c&&(c.innerHTML="סיום")),i(function(t,c){fetch(l+"/payment/update",{method:"POST",redirect:"error",signal:t,body:JSON.stringify({transaction:r,value:a,url:location.href})}).then(function(e){return i.verifyStatus(e,c,"notPermitted")}).then(function(e){return e.error?Promise.reject(e):e}).then(function(t){n.timer=setTimeout(function(){e(t,c)},2500-(+new Date-s)||0)})["catch"](function(e){c===o&&i.onError(d.serverError,e)})})},function(){var e,r,n,i,o;e=function(){var e,t=!1;try{e=Object.defineProperty({},"passive",{get:function(){return t=!0}}),addEventListener("test",e,e),removeEventListener("test",e,e)}catch(r){t=!1}return t?{passive:!0}:!0}(),i=setInterval(function(){t||o(),Math.round((new Date-r)/6e4)>=60&&(o(),s.remind())},24e4),n=function(){t&&(r=new Date)},o=function(){i&&(ui.w.removeEventListener("pointerdown",n,e),ui.w.removeEventListener("pointermove",n,e),clearTimeout(i),i=void 0)},ui.w.addEventListener("pointerdown",n,e),ui.w.addEventListener("pointermove",n,e)}(),c.classList.add("no-padding"),n.video+"<div class=content id=content dir=rtl>    <h1 id=title>"+ui.d.title+'</h1>    <div class="figure form qa">'+n.label(n.template,!1)+'</div>    <div class="figure footer">לא בטוחה לאלו צבעים את שייכת?<br>שלחי לי תמונת פנים ברורה שצולמה באור היום לוואטסאפ <a href="https://wa.me/972585800020" target=_blank dir=auto>0585800020</a> או למייל <a href="mailto:lea@laukstein.com" target=_blank dir=auto>lea@laukstein.com</a></div></div>'},e.formFinal=function(r,n){var i=e,o="",a="";return r.valueLocale?(r.modified&&(a=new Date(r.modified),a=a.getDate()+"/"+a.getMonth()+"/"+a.getFullYear(),a="<time>ההזמנה בוצעה ב "+a+"</time>"),t=!1,o+=(n?i.video:"")+"<div class=content>   <h1>"+r.valueLocale+"</h1>   <p>"+(r.descriptionLocale||"").replace(/\n/g,"<br>")+"</p>"+a+"</div>"):o+=e(),o},ui.w.addEventListener("hashchange",s.getData),ui.w.addEventListener("beforeunload",s.alert),ui.w.addEventListener("unload",s.remind),s.getData()});